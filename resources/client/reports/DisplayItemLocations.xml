<!DOCTYPE openRPTDef>
<report>
 <title>Item Locations By Site</title>
 <name>ItemLocationsByWarehouse</name>
 <description>Item Locations By Site</description>
 <size>A4</size>
 <portrait/>
 <topmargin>50</topmargin>
 <bottommargin>50</bottommargin>
 <rightmargin>33</rightmargin>
 <leftmargin>33</leftmargin>
 <querysource>
  <name>detail</name>
  <sql>SELECT
        location_id, 
        warehous_code, 
        item_number, 
        CASE WHEN (location_aisle || '-' || location_rack || '-' || location_bin || '-' || location_name) IS NULL THEN
              itemsite_location_comments
              ELSE location_aisle || '-' || location_rack || '-' || location_bin || '-' || location_name
        END AS location_name,
        formatlotserialnumber(itemloc_ls_id) AS lsnumber,
        formatqty(itemloc_qty)AS itemloc_qty, 
        CASE WHEN ((itemloc_expiration&lt;=startOfTime()) OR (itemloc_expiration >= endOfTime())) THEN text('N/A')
             WHEN (itemloc_expiration &lt; CURRENT_DATE) THEN text('expired')
 	    ELSE CAST(formatdate(itemloc_expiration) AS text)
        END AS expiration
FROM item,   warehous, itemsite
        LEFT OUTER JOIN itemloc  ON (itemloc_itemsite_id = itemsite_id)
        LEFT OUTER JOIN location ON (itemloc_location_id = location_id)
WHERE ((itemsite_item_id = item_id)
        &lt;? if exists("warehous_id") ?> 
        and (itemsite_warehous_id = &lt;? value("warehous_id") ?>)
        &lt;? endif ?> 
        and (itemsite_warehous_id = warehous_id)
        and (itemsite_loccntrl = 't' or itemsite_controlmethod = 'L')) 
ORDER BY warehous_code, item_number, itemloc_expiration, location_name, itemloc_qty;</sql>
 </querysource>
 <pghead>
  <firstpage/>
  <height>106</height>
  <label>
   <rect>
    <x>10</x>
    <y>85</y>
    <width>80</width>
    <height>13</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Site</string>
  </label>
  <label>
   <rect>
    <x>650</x>
    <y>85</y>
    <width>105</width>
    <height>13</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>bold</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Expiration</string>
  </label>
  <label>
   <rect>
    <x>530</x>
    <y>85</y>
    <width>85</width>
    <height>13</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>bold</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Qty</string>
  </label>
  <rect>
   <x>5</x>
   <y>80</y>
   <width>755</width>
   <height>20</height>
   <weight>0</weight>
  </rect>
  <label>
   <rect>
    <x>400</x>
    <y>85</y>
    <width>80</width>
    <height>13</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Lot/Serial</string>
  </label>
  <label>
   <rect>
    <x>250</x>
    <y>85</y>
    <width>80</width>
    <height>13</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Location</string>
  </label>
  <label>
   <rect>
    <x>10</x>
    <y>5</y>
    <width>675</width>
    <height>40</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>24</size>
    <weight>normal</weight>
   </font>
   <left/>
   <top/>
   <string>Item Location and Lot Detail by Site</string>
  </label>
  <label>
   <rect>
    <x>100</x>
    <y>85</y>
    <width>80</width>
    <height>13</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Item</string>
  </label>
 </pghead>
 <pghead>
  <height>28</height>
  <label>
   <rect>
    <x>10</x>
    <y>10</y>
    <width>80</width>
    <height>13</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Site</string>
  </label>
  <label>
   <rect>
    <x>100</x>
    <y>10</y>
    <width>80</width>
    <height>13</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Item</string>
  </label>
  <label>
   <rect>
    <x>530</x>
    <y>10</y>
    <width>85</width>
    <height>13</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>bold</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Qty</string>
  </label>
  <rect>
   <x>5</x>
   <y>5</y>
   <width>755</width>
   <height>20</height>
   <weight>0</weight>
  </rect>
  <label>
   <rect>
    <x>250</x>
    <y>10</y>
    <width>80</width>
    <height>13</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Location</string>
  </label>
  <label>
   <rect>
    <x>400</x>
    <y>10</y>
    <width>80</width>
    <height>13</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Lot/Serial</string>
  </label>
  <label>
   <rect>
    <x>650</x>
    <y>10</y>
    <width>105</width>
    <height>13</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>10</size>
    <weight>bold</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Expiration</string>
  </label>
 </pghead>
 <section>
  <name>detail</name>
  <detail>
   <key>
    <query>detail</query>
   </key>
   <height>27</height>
   <field>
    <rect>
     <x>650</x>
     <y>5</y>
     <width>105</width>
     <height>17</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>10</size>
     <weight>normal</weight>
    </font>
    <left/>
    <top/>
    <data>
     <query>detail</query>
     <column>expiration</column>
    </data>
   </field>
   <field>
    <rect>
     <x>530</x>
     <y>5</y>
     <width>85</width>
     <height>17</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>10</size>
     <weight>normal</weight>
    </font>
    <right/>
    <top/>
    <data>
     <query>detail</query>
     <column>itemloc_qty</column>
    </data>
   </field>
   <field>
    <rect>
     <x>250</x>
     <y>5</y>
     <width>155</width>
     <height>17</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>10</size>
     <weight>normal</weight>
    </font>
    <left/>
    <top/>
    <data>
     <query>detail</query>
     <column>location_name</column>
    </data>
   </field>
   <field>
    <rect>
     <x>100</x>
     <y>5</y>
     <width>165</width>
     <height>17</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>10</size>
     <weight>normal</weight>
    </font>
    <left/>
    <top/>
    <data>
     <query>detail</query>
     <column>item_number</column>
    </data>
   </field>
   <field>
    <rect>
     <x>10</x>
     <y>5</y>
     <width>60</width>
     <height>17</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>10</size>
     <weight>normal</weight>
    </font>
    <left/>
    <top/>
    <data>
     <query>detail</query>
     <column>warehous_code</column>
    </data>
   </field>
   <field>
    <rect>
     <x>400</x>
     <y>5</y>
     <width>125</width>
     <height>17</height>
    </rect>
    <font>
     <face>Arial</face>
     <size>10</size>
     <weight>normal</weight>
    </font>
    <left/>
    <top/>
    <data>
     <query>detail</query>
     <column>lsnumber</column>
    </data>
   </field>
  </detail>
 </section>
 <pgfoot>
  <height>53</height>
  <label>
   <rect>
    <x>10</x>
    <y>10</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <left/>
   <vcenter/>
   <string>Report Date:</string>
  </label>
  <field>
   <rect>
    <x>715</x>
    <y>10</y>
    <width>40</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>Context Query</query>
    <column>page_number</column>
   </data>
  </field>
  <field>
   <rect>
    <x>85</x>
    <y>10</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>bold</weight>
   </font>
   <left/>
   <vcenter/>
   <data>
    <query>Context Query</query>
    <column>report_date</column>
   </data>
  </field>
  <label>
   <rect>
    <x>610</x>
    <y>10</y>
    <width>100</width>
    <height>15</height>
   </rect>
   <font>
    <face>Arial</face>
    <size>8</size>
    <weight>normal</weight>
   </font>
   <right/>
   <vcenter/>
   <string>Page:</string>
  </label>
  <line>
   <xstart>10</xstart>
   <ystart>10</ystart>
   <xend>756</xend>
   <yend>10</yend>
   <weight>0</weight>
  </line>
 </pgfoot>
</report>
